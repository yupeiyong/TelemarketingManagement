@using JJsites.DomainModels
@using JJsites.DomainModels.Reports
@model JJsites.ViewModels.Reports.BudgetSourceSummaryReportDetailsViewModel
@{
    var amountSpecificationUnit = Model.AmountSpecificationUnit;
    var reports = Model.BudgetSourceSummaryReports ?? new List<BudgetSourceSummaryReport>();
}

@if (reports.Count > 0)
{
    foreach (var report in reports)
    {
        var unitlevels = report.BudgetUnitLevels ?? new List<BudgetUnitLevel>();
        foreach (var category in report.BudgetSourceSummaryReportCategories)
        {
            foreach (var reportItem in category.ReportItems)
            {
                <tr>
                    <!--<td>@reportItem.Id</td>-->
                    <td>@Html.Raw(reportItem.FunctionSubject?.CustomedNumberAndNameWithHtmlSpaces)</td>
                    <td style="text-align: right">@((reportItem.TotalAdjustmentAmount / amountSpecificationUnit).ToString("N"))</td>
                    <td style="text-align: right">@((reportItem.TotalAssignedAmount / amountSpecificationUnit).ToString("N"))</td>
                    @foreach (var level in unitlevels)
                    {
                        <td style="text-align: right">@((reportItem[level].AssignedAmount / amountSpecificationUnit).ToString("N"))</td>
                    }
                    <td style="text-align: right">@((reportItem.TotalUndistributedAmount / amountSpecificationUnit).ToString("N"))</td>
                </tr>
            }
            <tr>
                <!--<td></td>-->
                <td>@(category.MoneyNature.Name + "小计：")</td>
                <td style="text-align: right">@((category.TotalAdjustmentAmount / amountSpecificationUnit).ToString("N"))</td>
                <td style="text-align: right">@((category.TotalAssignedAmount / amountSpecificationUnit).ToString("N"))</td>
                @foreach (var level in unitlevels)
                {
                    if (category.BudgetSourceSummaryReportItemUnitLevelAssignedAmounts.ContainsKey(level))
                    {
                        <td style="text-align: right">@((category.BudgetSourceSummaryReportItemUnitLevelAssignedAmounts[level] / amountSpecificationUnit).ToString("N"))</td>
                    }
                    else
                    {
                        <td></td>
                    }
                }
                <td style="text-align: right">@((category.TotalUndistributedAmount / amountSpecificationUnit).ToString("N"))</td>
            </tr>
        }
        <tr>
            <!--<td></td>-->
            <td>合计：</td>
            <td style="text-align: right">@((report.TotalAdjustmentAmount / amountSpecificationUnit).ToString("N"))</td>
            <td style="text-align: right">@((report.TotalAssignedAmount / amountSpecificationUnit).ToString("N"))</td>
            @foreach (var level in unitlevels)
            {
                if (report.BudgetSourceSummaryReportTotalUnitLevelAssignedAmounts.ContainsKey(level))
                {
                    <td style="text-align: right">@((report.BudgetSourceSummaryReportTotalUnitLevelAssignedAmounts[level] / amountSpecificationUnit).ToString("N"))</td>
                }
                else
                {
                    <td></td>
                }
            }
            <td style="text-align: right">@((report.TotalUndistributedAmount / amountSpecificationUnit).ToString("N"))</td>
        </tr>
    }
}
else
{
    <tr class="no-records-found">
        <td colspan="6">没有找到匹配的记录</td>
    </tr>
}