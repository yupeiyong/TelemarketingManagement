@using JJsoft.Infrastructure.Extensions
@model List<JJsites.DomainModels.Reports.BudgetSourceReport>

    <div class="container-fluid">
        <div class="CurrentPosition">
            <img src="~/Content/Images/icon_currentPosition.png" />
            当前位置：后台管理系统 > 预算来源报表
        </div>
        <div class="row clearfix conditional">
            <div class="pull-left">
            </div>
            <div class="pull-right">
                <div class="btn-group">
                    <div class="form-search">
                        <form class="search form-inline">
                            <div class="form-group">
                                <label class="control-label">时间：</label>
                                <input type="date" value="@DateTime.Now.AddMonths(-1).ToDateString()" class="form-control bk-radius" name="StartDatetime" id="StartDateTime" placeholder="开始时间...">
                                <span>-</span>
                                <input type="date" value="@DateTime.Today.ToDateString()" class="form-control bk-radius" name="EndDatetime" id="EndDateTime" placeholder="最后时间...">
                                &nbsp;&nbsp;
                                <input type="text" class="form-control bk-radius" name="Keywords" id="Keywords" placeholder="关键词...">
                                <button type="button" class="btn btn-info" @*id="btnSearch"*@ onclick="RefreshList();">
                                    <i class="fa fa-search"></i>
                                    搜索
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="btn-group">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default btn-sm" id="btnAdd" title="生成" onclick="ReportGenerate(this);">
                            <i class="fa fa-plus-circle" aria-hidden="true"></i>
                            生成
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-md-12">
                <div class="bootstrap-table">
                    <div class="fixed-table-toolbar"></div>
                    <div class="fixed-table-container" style="padding-bottom: 0px;">
                        <div class="fixed-table-header" style="display: none;">
                            <table></table>
                        </div>
                        <div class="fixed-table-body">
                            <div class="fixed-table-loading" style="display: none; top: 41px;">正在努力地加载数据中，请稍候……</div>
                            <table id="tab" data-id-field="Id" data-resizable="true" data-filter-control="false" class="table table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th style="text-align: center; vertical-align: middle; width: 50px;" data-field="_id" tabindex="0">
                                            <div class="th-inner ">
                                                ID
                                            </div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle;">
                                            <div class="th-inner">
                                                预算来源
                                            </div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle;">
                                            <div class="th-inner">
                                                创建人
                                            </div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle;">
                                            <div class="th-inner">
                                                创建时间
                                            </div>
                                            <div class="fht-cell"></div>
                                        </th>
                                        <th style="text-align: center; vertical-align: middle; width: 120px;" data-field="Id" tabindex="0">
                                            <div class="th-inner ">
                                                操作
                                            </div>
                                            <div class="fht-cell"></div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!--js拉取加载数据-->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>


    <script type="text/javascript">

        $(function () {
            RefreshList();
        });

        function ReportGenerate(btn) {
            var url = '@Url.Action("GenerateReport")';

            var $btn = $(btn);
            $btn.attr("disabled", true);
            var originalText = $btn.text();
            $btn.text('正在生成报表...');
            $.post(url, null, function (response) {
                layer.msg(response.Message, { time: 7000 });
                if (response.Success) {
                    RefreshList();
                }
                $btn.text(originalText);
                $btn.attr("disabled", false);
            }, "json");
        }

        function RefreshList() {
            var message = "<tr class='no-records-found'><td colspan='6'>正在加载数据</td></tr>";
            $("tbody").html(message);

            var params = $('form.search').serializeArray();
            //var keyWords = $("input[name=Keywords]").val();
            var url = '@Url.Action("ListPartial")';
            $.post(url,
                params,
                function (response) {
                    $("tbody").html(response);
                },
                "html");
        }

        $(document).keydown(function (event) {
            if (event.which == 13) {
                RefreshList();
                return false;
            }
        });
    </script>
